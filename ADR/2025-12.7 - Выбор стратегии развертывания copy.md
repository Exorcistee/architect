
**ADR: 2025-12.7 - Выбор стратегии развертывания**

**Дата:** 2 декабря 2025 г.

**Статус:** 

**Контекст:**

Чтобы наша платформа для онлайн-консультаций работала стабильно, нужно решить, как код попадает в продакшен: частота релизов, процесс деплоя, стратегия обновления, отката и мониторинга. 

**Рассмотренные варианты:**

**Ручные деплои по расписанию**: Разработчики вручную обновляют сервера в запланированное время.
**Автоматический CI/CD**: Автоматическая сборка и деплой с двумя идентичными средами для мгновенного переключения.
**Canary-релизы**: Постепенный накат обновлений на небольшие группы пользователей перед полным выпуском.
**Feature flags**: Управление включением новых функций через переключатели в реальном времени без перезапуска.

**Решение:**

Выбран подход автоматический CI/CD с blue-green деплоем и feature flags.

**Обоснование:**

- **Частые и безопасные обновления:** Можно выпускать несколько обновлений в день с минимальным риском для пользователей.
- **Нет простоя:** Blue-green подход исключает время простоя при обновлении системы.
- **Контроль над функциями:** Feature flags позволяют включать новые возможности только для определённых пользователей (например, для тестирования).
- **Быстрый откат:** При обнаружении проблемы можно мгновенно вернуться на предыдущую версию.
  
**Недостатки**

- **Сложная настройка**: Требует больше времени и экспертизы для первоначальной настройки.
- **Дороже в эксплуатации**: Нужно содержать две одинаковые среды (blue и green), что увеличивает затраты.
- **Риск конфликтов конфигурации**: Feature flags могут усложнить код и вызвать неожиданные взаимодействия между функциями.

**Последствия:**

- Вся инфраструктура будет описываться кодом (Infrastructure as Code).
- Будет настроен автоматический пайплайн сборки, тестирования и деплоя.
- Для управления feature flags будет выбран и внедрён специализированный инструмент.


