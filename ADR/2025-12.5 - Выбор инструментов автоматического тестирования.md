
**ADR: 2025-12.5 - Выбор инструментов автоматическеого тестирования**

**Дата:** 2 декабря 2025 г.

**Статус:** 

**Контекст:**

Чтобы наша платформа для онлайн-консультаций работала без сбоев, ее нужно тестировать. Нужно выбрать инструменты для автоматического тестирования серверной и клиентской части.

**Рассмотренные варианты:**

**Unit-тесты для сервера (Node.js/TypeScript)**:
    **Jest**: самый популярный, много готовых решений, интегрируется с NestJS
    **Vitest**: быстрее Jest, но менее стабилен для бэкенда
    **Mocha + Chai + Sinon**: гибкая настройка, но нужно собирать стек самостоятельно

**Тестирование React-компонентов**:
    **Jest + React Testing Library** — стандартный выбор React-сообщества
    **Vitest + Testing Library** — быстрее, но может быть меньше документации
    **Enzyme** — устаревший, не рекомендуется для новых проектов

**API и интеграционные тесты**:
    **Supertest + Jest** — простой, работает внутри Jest
    **Postman + Newman** — удобно для ручного тестирования, но сложнее автоматизировать
    **Playwright API testing** — современный, но избыточный для чистого API

**E2E-тесты веб-интерфейса**:
    **Playwright** — поддержка всех браузеров, встроенные ожидания
    **Cypress** — только Chromium, сложнее с параллельным запуском
    **Selenium** — устаревший, требует много настроек

**Решение:**

Unit и интеграционные тесты сервера: Jest
Тестирование React-компонентов: Jest + React Testing Library
API тесты: Supertest + Jest
E2E-тесты интерфейса: Playwright

**Обоснование:**

- **Снижение сложности для команды:** Разработчикам нужно знать меньше инструментов, что ускоряет обучение и уменьшает количество ошибок в настройке.
- **Единые стандарты и конфигурация:** Одинаковый синтаксис тестов на всех уровнях проекта, общие правила написания и запуска тестов.
- **Экономия времени на поддержке:** Меньше конфигурационных файлов, проще обновлять зависимости, легче решать проблемы совместимости.
- **Более быстрая обратная связь:** Упрощённый процесс запуска всех типов тестов локально и в CI/CD.
  
**Недостатки**

- **Сложность отладки падающих тестов**: Когда все тесты используют один инструмент, сложнее изолировать причину падения.
- **Ограничения для тестирования адаптивного дизайна**: E2E-фреймворк требует отдельной настройки для каждого разрешения экрана, что увеличивает время выполнения тестов в 3-4 раза.
- **Высокие требования к CI/CD инфраструктуре**: Для запуска E2E-тестов с поддержкой всех браузеров нужны мощные агенты с графической подсистемой, что увеличивает стоимость сборок на 40-50%.

**Последствия:**

- Все разработчики в команде должны освоить выбранный единый фреймворк для unit и интеграционных тестов.
- Необходимо создать единые конфигурационные файлы, которые работают и для серверного, и для клиентского кода.
- При найме новых разработчиков знание выбранного стека тестирования будет обязательным требованием.

